<div class="container-fluid card h-100 py-5">
	<div class="card-body w-100 d-flex">
        <div class="position-absolute" style=" left: 5%;">
            <button class="btn btn-outline" [routerLink]="'/auth/forgot-password'">
                <i class="fa fa-arrow-left mr-1"></i>
                <span class="fw-500">Quay lại</span>
            </button>
        </div>
        <ng-container *ngIf="!isPassOtp">
		    <div class="form mx-auto my-sm-auto w-100">
                <div class="d-flex justify-content-center">
                    <img alt="Logo" src="../../assets/media/logos/logo-at-splash.png" width="250" height="75" />
                </div>
                <h1 class="title mb-4 mt-8">Điền mã xác thực để đặt lại mật khẩu</h1>
                <div class="text-center mb-5">
                    <span class="fw-500 mb-0">Mã xác thực gồm 6 chữ số đã được gửi vào email của bạn </span>
                    <span class="fw-600">{{ email }}</span>
                </div>

                <div class="row">
                    <div class="col-12 d-flex align-items-center gap-3">
                        <input class="form-control text-center" placeholder="Nhập mã xác thực" maxlength="6" [(ngModel)]="inputOtp" [ngModelOptions]="{ standalone: true }"
                            onkeypress="return (event.charCode == 8 || event.charCode == 0 ) ? null : event.charCode >= 48 && event.charCode <= 57">
                        <button class="btn btn-orange min-w-100px text-nowrap" (click)="submitOtp()" *ngIf="!disabledButtonOtp" [disabled]="inputOtp?.length !== 6">Tiếp tục</button>
                        <button *ngIf="disabledButtonOtp" class="btn btn-orange min-w-100px d-flex justify-content-center" style="height: 45.56px;">
                            <img src="../../../../assets/media/common/loading-gif.gif" width="20" height="20">
                        </button>
                    </div>
                    <div class="text-center mt-4">
                        <span class="fw-500">Không nhận được mã?</span>
                        <span *ngIf="!isCount" (click)="resendOtp()" class="text-orange fw-600 ml-1 cursor-pointer resend">Gửi lại</span>
                        <span *ngIf="isCount" class="text-orange-disable fw-600 ml-1" style="width: 160px !important">
                            Gửi lại ({{ countdown }})
                        </span>
                    </div>
                    <div class="text-center mt-2" style="color: #475467; font-size: 11.5px">
                        Bạn có tối đa 2 lần gửi lại email/ngày. Nếu không nhận được email, vui lòng kiểm tra hòm thư spam hoặc xem lại địa chỉ nhận email.
                    </div>
                    <!-- <div class="col-12 mt-10">
                        <button class="btn btn-orange w-100" (click)="submitOtp()" *ngIf="!disabledButtonOtp"
                                [disabled]="!inputOtp">Hoàn tất</button>
                        <button *ngIf="disabledButtonOtp" class="btn btn-orange w-100 d-flex justify-content-center" style="height: 45.56px;">
                            <img src="../../../../assets/media/common/loading-gif.gif" width="20" height="20">
                        </button>
                    </div> -->
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="isPassOtp">
		    <div class="form mx-auto my-sm-auto my-10 w-100">
                <form [formGroup]="form">
                    <div class="d-flex justify-content-center">
                        <img alt="Logo" src="../../assets/media/logos/logo-at-splash.png" width="250" height="75" />
                    </div>
                    <h1 class="title mb-4 mt-8">Tạo mật khẩu mới</h1>
    
                    <div class="row">
                        <div class="col-12 mb-4">
                            <label class="form-label required">Mật khẩu mới</label>
                            <div class="position-relative d-flex align-items-center">
                                <input type="{{ showPw ? 'text' : 'password' }}" placeholder="Nhập mật khẩu" formControlName="password" maxlength="16" class="form-control bg-img-none" 
                                    [ngClass]="{'is-invalid': (helperService.showStatusError(form, 'password') || !checkMatchPassword())}" 
                                    (change)="changeText($event, 'password')" (input)="helperService.onInputForm(form, 'password', $event, {trim: true});"
                                    (focusout)="helperService.onTrimFocusOutForm(form, 'password', $event)">
                                <a class="position-absolute cursor-pointer p-2" style="right: 15px;" (click)="showPassword(1)">
                                    <i class="fa {{ showPw ? 'fa-eye' : 'fa-eye-slash' }}"></i>
                                </a>
                            </div>
                            <p class="mb-0 mt-1 fs12" style="color: #475467">Mật khẩu có độ dài từ 8-16 ký tự, không bao gồm ký tự có dấu và khoảng trắng.</p>
                            <at-error [control]="form.get('password')" validation="required" message="Mật khẩu không được để trống."></at-error>
                            <at-error [control]="form.get('password')" validation="minlength" [message]="'Mật khẩu có độ dài tối thiểu 8 ký tự.'"></at-error>
                            <at-error [control]="form.get('password')" validation="pattern" [message]="'Mật khẩu không bao gồm dấu và khoảng trắng.'"></at-error>
                            <div class="sub-invalid" *ngIf="fails && fails['password']">
                                <span>{{ fails['password'][0] }}</span>
                            </div>
                        </div>
                        <div class="col-12 mb-4">
                            <label class="form-label required">Nhập lại mật khẩu</label>
                            <div class="position-relative d-flex align-items-center">
                                <input type="{{ showConfirmPw ? 'text' : 'password' }}" placeholder="Nhập lại mật khẩu"
                                    formControlName="password_confirmation" maxlength="16" class="form-control bg-img-none" maxlength="16"
                                    [ngClass]="{'is-invalid': helperService.showStatusError(form, 'password_confirmation') || !checkMatchPassword()}" (change)="checkMatchPassword()"
                                    (input)="helperService.onInputForm(form, 'password_confirmation', $event, {trim: true})">
                                <a class="position-absolute cursor-pointer p-2" style="right: 15px;" (click)="showPassword(2)">
                                    <i class="fa {{ showConfirmPw ? 'fa-eye' : 'fa-eye-slash' }}"></i>
                                </a>
                            </div>
                            <at-error [control]="form.get('password_confirmation')" validation="required" message="Mật khẩu nhập lại không được để trống."></at-error>
                            <p *ngIf="!checkMatchPassword()" class="text-red-500 mt-1">
                                Mật khẩu và mật khẩu nhập lại không trùng khớp
                            </p>
                        </div>
                        <div class="col-12 mb-5 mt-5">
                            <button *ngIf="!disabledButton" class="btn btn-orange w-100" (click)="submitNewPassword()"
                                [disabled]="form.invalid || disabledButton">Hoàn tất</button>
                            <button *ngIf="disabledButton" class="btn btn-orange w-100 d-flex justify-content-center" style="height: 45.56px;">
                                <img src="../../../../assets/media/common/loading-gif.gif" width="20" height="20">
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </ng-container>
	</div>
</div>

<app-spinner [loading]="isVerifyToken"></app-spinner>
