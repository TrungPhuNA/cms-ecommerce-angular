<form [formGroup]="form">
	<div class="row">
		<label class="form-label col-md-3 col-12" translate>Tên yêu cầu</label>
		<div class="col-md-9 col-12">
			<input class="form-control"
				[ngClass]="{'is-invalid': (helperService.showStatusError(form, 'name', submitted))}"
				(focusout)="helperService.onTrimFocusOutForm(form, 'name', $event)"
				placeholder="{{ 'Đặt tên để ghi nhớ' | translate }}" formControlName="name" maxlength="255" />
			<at-error [submitted]="submitted" [control]="form.get('name')" validation="required"
				message="Trường này không được để trống.">
			</at-error>
			<at-error [submitted]="submitted" [control]="form.get('name')" validation="maxlength"
				message="Tên yêu cầu vượt quá giới hạn cho phép.">
			</at-error>
		</div>
	</div>
	<hr class="line-gray mt-5 mb-5">
	<div class="row">
		<label class="form-label col-md-3 col-12 required" translate>Vấn đề/nhu cầu/bài toán cần giải</label>
		<div class="col-md-9 col-12">
			<textarea class="form-control" rows="5" formControlName="description"
				(focusout)="helperService.onTrimFocusOutForm(form, 'description', $event)"
				[ngClass]="{'is-invalid': (helperService.showStatusError(form, 'description', submitted))}"
				placeholder="{{ 'Vui lòng mô tả cụ thể, nội dung mô tả càng chi tiết sẽ giúp chúng tôi tiếp nhận yêu cầu nhanh hơn...' | translate }}"></textarea>
			<at-error [submitted]="submitted" [control]="form.get('description')" validation="required"
				message="Trường này không được để trống.">
			</at-error>
		</div>
	</div>
	<hr class="line-gray mt-5 mb-5">
	<ng-container formGroupName="info">
		<div class="row">
			<label class="form-label col-md-3 col-12 required" translate>Link giới thiệu sản phẩm</label>
			<div class="col-md-9 col-12">
				<input class="form-control " (focusout)="helperService.onTrimFocusOutForm(info, 'link', $event)"
					(input)="helperService.onInputForm(info, 'link', $event, {lower: true, trim: true})"
					[ngClass]="{'is-invalid': (helperService.showStatusError(info, 'link', submitted) || (fails && fails['info.link']))}"
					placeholder="{{ 'yourcompany.com' | translate }}" formControlName="link"
					(change)="onChange($event)" />

				<ng-container *ngIf="fails && fails['info.link']">
					<at-error [isForm]="false" [message]="fails['info.link'][0]"></at-error>
				</ng-container>
				<at-error [submitted]="submitted" [control]="link" validation="pattern"
					message="Trường này không đúng định dạng."></at-error>
				<at-error [submitted]="submitted" [control]="link" validation="required"
					message="Trường này không được để trống."></at-error>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">
		<div class="row">
			<label class="col-md-3 col-12 form-label required" translate>Sản lượng bán hiện tại</label>
			<div class="col-md-9 col-12">
				<ng-select [items]="quantity_sale_config" bindLabel="name" bindValue="value" [hideSelected]="true"
					[ngClass]="{'is-invalid': helperService.showStatusError(info, 'quantity_sale', submitted)}"
					placeholder="{{ 'Chọn sản lượng' | translate }}" formControlName="quantity_sale"></ng-select>
				<at-error [submitted]="submitted" [control]="info.get('quantity_sale')" validation="required"
					message="Trường này không được để trống.">
				</at-error>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">
		<div class="row">
			<label class="form-label col-md-3 col-12" translate>Điểm khác biệt của sản phẩm</label>
			<div class="col-md-9 col-12">
				<textarea class="form-control" rows="5" formControlName="usp"
					(focusout)="helperService.onTrimFocusOutForm(info, 'usp', $event)"
					placeholder="{{ 'Vui lòng mô tả cụ thể, nội dung mô tả càng chi tiết sẽ giúp chúng tôi tiếp nhận yêu cầu nhanh hơn...' | translate }}">
			</textarea>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">

		<div class="row">
			<label class="form-label col-md-3 col-12 required" translate>Phân khúc và chân dung khách hàng</label>
			<div class="col-md-9 col-12">
				<textarea class="form-control" rows="5" formControlName="customer"
					(focusout)="helperService.onTrimFocusOutForm(info, 'customer', $event)"
					[ngClass]="{'is-invalid': (helperService.showStatusError(info, 'customer', submitted))}"
					placeholder="{{ 'Vui lòng mô tả cụ thể, nội dung mô tả càng chi tiết sẽ giúp chúng tôi tiếp nhận yêu cầu nhanh hơn...' | translate }}">
				</textarea>
				<at-error [submitted]="submitted" [control]="info.get('customer')" validation="required"
					message="Trường này không được để trống.">
				</at-error>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">

		<div class="row">
			<label class="form-label col-md-3 col-12" translate>Thị trường tập trung</label>
			<div class="col-md-9 col-12">
				<ng-select [items]="configs.focus_area" bindLabel="name" bindValue="value" [multiple]="true"
					[hideSelected]="true" placeholder="{{ 'Chọn thị trường' | translate }}"
					formControlName="focus_area">
				</ng-select>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">

		<div class="row">
			<label class="form-label col-md-3 col-12" translate>Chương trình khuyến mãi</label>
			<div class="col-md-9 col-12">
				<textarea class="form-control" rows="5"
					(focusout)="helperService.onTrimFocusOutForm(info, 'bonus_policy', $event)"
					placeholder="{{ 'Vui lòng mô tả cụ thể, nội dung mô tả càng chi tiết sẽ giúp chúng tôi tiếp nhận yêu cầu nhanh hơn...' | translate }}"
					formControlName="bonus_policy">
			</textarea>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">

		<div class="row">
			<label class="form-label col-md-3 col-12" translate>Chính sách hậu mãi</label>
			<div class="col-md-9 col-12">
				<textarea class="form-control" rows="5" formControlName="after_sale_policy"
					(focusout)="helperService.onTrimFocusOutForm(info, 'after_sale_policy', $event)"
					placeholder="{{ 'Vui lòng mô tả cụ thể, nội dung mô tả càng chi tiết sẽ giúp chúng tôi tiếp nhận yêu cầu nhanh hơn...' | translate }}">
			</textarea>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">

		<div class="row">
			<label class="form-label col-md-3 col-12" translate>Các kênh online/offline đang chạy</label>
			<div class="col-md-9 col-12">
				<ng-container *ngFor="let item of viral_info_list; index as i">
					<div
						class="form-control d-md-flex position-relative form-link-onl align-items-center mb-2 gap-3 {{ errorLink(i) ? 'is-invalid' : '' }}">
						<div class="d-flex d-sm-block align-items-center">
							<ng-select [items]="viral_info_config" bindLabel="name" bindValue="name" placeholder="Chọn"
								style="min-width: 170px" [clearable]="false" class="my-2 form-link-onl--select"
								[(ngModel)]="item.name" [ngModelOptions]="{ standalone: true }"></ng-select>
							<i *ngIf="viral_info_list.length > 1" class="fa fa-xmark cursor-pointer p-2 mx-2 d-sm-none"
								(click)="removeViralInfo(i)"></i>
						</div>
						<input class="form-control my-2 p-2 px-4 w-100" style="height: 43px !important;"
							placeholder="{{ 'Nhập kênh của bạn' | translate }}" [(ngModel)]="item.value"
							[ngModelOptions]="{ standalone: true }" (change)="onChangeViralInfo($event, i)" />
						<i *ngIf="viral_info_list.length > 1" class="fa fa-xmark cursor-pointer d-none d-sm-block p-2"
							(click)="removeViralInfo(i)"></i>
					</div>
					<ng-container *ngIf="errorLink(i)">
						<at-error [isForm]="false" [message]="'Link không đúng định dạng'"></at-error>
					</ng-container>
				</ng-container>
				<div class="text-center cursor-pointer mt-4" (click)="addViralInfo()"
					style="border: 1px solid #D0D5DD; border-style: dashed; border-radius: 8px; padding: 8px 12px">
					<i class="fa fa-plus mr-2"></i> Thêm kênh
				</div>
			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">

		<div class="row">
			<label class="col-md-3 col-12 form-label" translate>Tỉ lệ chuyển đổi từ click sang đơn hàng</label>
			<div class="col-md-9 col-12">
				<input class="form-control" placeholder="{{ '' | translate }}" formControlName="conversion_rate" />

			</div>
		</div>
		<hr class="line-gray mt-5 mb-5">

		<div class="row">
			<label class="col-md-3 col-12 form-label required" translate>Mục tiêu kỳ vọng</label>
			<div class="col-md-9 col-12">
				<input class="form-control" placeholder="{{ '' | translate }}"
					(focusout)="helperService.onTrimFocusOutForm(info, 'performance', $event)"
					[ngClass]="{'is-invalid': (helperService.showStatusError(info, 'performance', submitted))}"
					formControlName="performance" />
				<at-error [submitted]="submitted" [control]="info.get('performance')" validation="required"
					message="Trường này không được để trống.">
				</at-error>
			</div>
		</div>
	</ng-container>

	<hr class="line-gray mt-5 mb-5">
	<div class="row">
		<label class="col-md-3 col-12 form-label required" translate>Giải pháp lựa chọn</label>
		<div class="col-md-9 col-12">
			<ng-select [items]="configs.service_type" [multiple]="true" bindLabel="full_name" bindValue="value"
				[hideSelected]="true"
				[ngClass]="{'is-invalid': (helperService.showStatusError(form, 'service_type', submitted))}"
				placeholder="{{ 'Chọn giải pháp' | translate }}" formControlName="service_type"></ng-select>
			<at-error [submitted]="submitted" [control]="form.get('service_type')" validation="required"
				message="Trường này không được để trống.">
			</at-error>
		</div>
	</div>
	<ng-container  *ngIf="form?.value?.service_type?.length > 0">
		<hr class="line-gray mt-5 mb-5">
		<div class="row">
			<label class="form-label col-md-3 col-12" translate>Sản phẩm theo giải pháp</label>
			<div class="col-md-9 col-12">
				<ng-select [items]="service_products_config" [multiple]="true" bindLabel="name" bindValue="value"
					[hideSelected]="true" (change)="selectedProducts($event)"
					[ngClass]="{'is-invalid': (helperService.showStatusError(form, 'products', submitted))}"
					placeholder="{{ 'Chọn sản phẩm' | translate }}" formControlName="products"></ng-select>
				<at-error [submitted]="submitted" [control]="form.get('products')" validation="required"
					message="Trường này không được để trống.">
				</at-error>
			</div>
		</div>
	</ng-container>
	
	
	<hr class="line-gray mt-5 mb-5">
	<div class="row">
		<label class="form-label col-md-3 col-12" translate>Thời gian mong muốn</label>
		<div class=" col-md-9 col-12">
			<div class="row">
				<div class="col-md-6 col-12 mb-2">
					<input type="date" class="form-control" placeholder="DD-MM-YYYY"
						[ngClass]="{'is-invalid': messageErrorDate && (submitted || helperService.checkTouchOrDirty(form, 'desired_timeline_start'))}"
						min="{{currentDate}}" formControlName="desired_timeline_start" />
				</div>
				<div class="col-md-6 col-12 mb-2">
					<input type="date" class="form-control" placeholder="DD-MM-YYYY" min="{{minDateEnd}}"
						[ngClass]="{'is-invalid': messageErrorDate && (submitted || helperService.checkTouchOrDirty(form, 'desired_timeline_end'))}"
						formControlName="desired_timeline_end" />
				</div>
				<div class="col-12">
					<at-error [submitted]="submitted" [isForm]="false" [control]="form.get('desired_timeline_end')"
						[message]="messageErrorDate">
					</at-error>
				</div>
			</div>
		</div>
	</div>
	<hr class="line-gray mt-5 mb-5">

	<hr class="line-gray mt-5 mb-5">
	<div class="row">
		<label class="col-md-3 col-12 form-label required" translate>Ngân sách sẵn sàng chi trả</label>
		<div class="col-md-9 col-12">
			<ng-select [items]="configs.rank_budget" bindLabel="name" bindValue="value" [hideSelected]="true"
				[ngClass]="{'is-invalid': (helperService.showStatusError(form, 'rank_budget', submitted))}"
				placeholder="{{ 'Chọn mức ngân sách' | translate }}" formControlName="rank_budget"></ng-select>
			<at-error [submitted]="submitted" [control]="form.get('rank_budget')" validation="required"
				message="Trường này không được để trống.">
			</at-error>
		</div>
	</div>
	<hr class="line-gray mt-5 mb-5">
	<ng-container formGroupName="info">
		<div class="row">
			<label class="col-md-3 col-12 form-label required" translate>Luồng người dùng cần thực hiện chính</label>
			<div class="col-md-9 col-12">
				<textarea class="form-control" rows="5"
					(focusout)="helperService.onTrimFocusOutForm(info, 'user_flow', $event)" placeholder="Ví dụ:
Bước 1: Cài đặt ứng dụng trên App Store
Bước 2: Đăng ký tài khoản, nhập mã giới thiệu ACCESSTRADE
Bước 3: EKYC thành công" [ngClass]="{'is-invalid': helperService.showStatusError(info, 'user_flow', submitted)}"
					formControlName="user_flow"></textarea>
				<at-error [submitted]="submitted" [control]="info.get('user_flow')" validation="required"
					message="Trường này không được để trống.">
				</at-error>
			</div>
		</div>
	</ng-container>

	<div class="welcome-text mt-8 mb-3">Thông tin liên hệ</div>
	<hr class="line-gray mt-5 mb-5">

	<div class="d-md-flex">
		<div class="w-md-50 w-100 m-2 p-3 border rounded">
			<div class="welcome-text-content m-3">Doanh nghiệp</div>
			<hr class="line-gray mt-5 mb-5">
			<ng-container formGroupName="contact_info">
				<div class="row">
					<label class="col-md-3 col-12 form-label required" translate>Họ và tên</label>
					<div class="col-md-9 col-12">
						<input class="form-control" placeholder="{{ 'Nguyễn Văn A' }}"
							[ngClass]="{'is-invalid': (helperService.showStatusError(contact_info, 'name', submitted))}"
							(focusout)="helperService.onTrimFocusOutForm(contact_info, 'name', $event)"
							formControlName="name" />
						<at-error [submitted]="submitted" [control]="contact_info?.get('name')" validation="required"
							message="Trường này không được để trống.">
						</at-error>

						<at-error [submitted]="submitted" [control]="contact_info?.get('name')" validation="pattern"
							message="Trường này không đúng định dạng.">
						</at-error>
					</div>
				</div>
				<hr class="line-gray mt-5 mb-5">
				<div class="row">
					<label class="col-md-3 col-12 form-label required" translate>Email</label>
					<div class="col-md-9 col-12">
						<input class="form-control" placeholder="{{ 'nva@gmail.com' }}"
							[ngClass]="{'is-invalid': (helperService.showStatusError(contact_info, 'email', submitted))}"
							(input)="helperService.onInputForm(contact_info, 'email', $event, {trim: true, lower: true})"
							formControlName="email" />
						<at-error [submitted]="submitted" [control]="contact_info?.get('email')" validation="required"
							message="Trường này không được để trống.">
						</at-error>
						<at-error [submitted]="submitted" [control]="contact_info?.get('email')" validation="pattern"
							message="Trường này không đúng định dạng.">
						</at-error>
					</div>
				</div>
				<hr class="line-gray mt-5 mb-5">
				<div class="row">
					<label class="col-md-3 col-12 form-label required" translate>Số điện thoại</label>
					<div class="col-md-9 col-12">
						<input class="form-control" placeholder="{{ '0123456789' }}"
							(input)="helperService.onInputForm(contact_info, 'phone', $event, {trim: true})"
							[ngClass]="{'is-invalid': (helperService.showStatusError(contact_info, 'phone', submitted))}"
							formControlName="phone" />
						<at-error [submitted]="submitted" [control]="contact_info?.get('phone')" validation="required"
							message="Trường này không được để trống.">
						</at-error>
						<at-error [submitted]="submitted" [control]="contact_info?.get('phone')" validation="pattern"
							message="Trường này không đúng định dạng.">
						</at-error>
					</div>
				</div>
			</ng-container>
		</div>
		<div class="w-md-50 w-100 p-3 m-2 border rounded">
			<div class="welcome-text-content m-3">ACCESSTRADE</div>

			<hr class="line-gray mt-5 mb-5">
			<div class="row">
				<div class="col-md-3 col-12">
					<label class="form-label" translate>Họ và tên</label>
				</div>
				<div class="col-md-9 col-12">
					<input class="form-control" [value]="data?.follow_info?.name" [disabled]="true">
				</div>
			</div>
			<hr class="line-gray mt-5 mb-5">
			<div class="row">
				<div class="col-md-3 col-12">
					<label class="form-label" translate>Email</label>
				</div>
				<div class="col-md-9 col-12">
					<input class="form-control" [value]="data?.follow_info?.email" [disabled]="true">
				</div>
			</div>
			<hr class="line-gray mt-5 mb-5">
			<div class="row">
				<div class="col-md-3 col-12">
					<label class="form-label" translate>Số điện thoại</label>
				</div>
				<div class="col-md-9 col-12 ">
					<div class="form-control form-control-disabled text-break" *ngIf="data?.follow_info?.phone">
						<a class="text-input-color-disabled text-decoration-underline" style="color: #009ef7;"
							href="{{  checkHttpLink(data?.follow_info?.phone, {start:'https://zalo.me/' }) }}"
							target="_blank">{{ data?.follow_info?.phone }}</a>
					</div>
					<input class="form-control" *ngIf="!data?.follow_info?.phone" [disabled]="true">
				</div>
			</div>
		</div>
	</div>

	<hr class="line-gray mt-5 mb-5">

	<div class="d-flex justify-content-center gap-5">
		<button class="btn btn-outline-base" style="min-width: 125px;" (click)="onClose()" translate>Hủy bỏ</button>
		<button class="btn btn-orange" (click)="submit()"  style="min-width: 125px;"
		[disabled]="form.invalid" translate>Lưu chỉnh sửa</button>
	</div>
</form>
<app-spinner [loading]="loading"></app-spinner>